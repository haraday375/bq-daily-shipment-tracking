# bq-daily-shipment-tracking
BigQuery query sample for daily tracking of product shipments, returns, and active rentals.

### 背景
商品別の貸出数、出荷数、返却予定数を日次で可視化する目的で作成したクエリの汎用版です。
実務では「貸出中の在庫数」「出荷・返却の予測変動」を同時に把握するニーズがあり、
出荷日〜返却日までのレンジ集計と、単日集計を分離して行っています。

実務では「貸出中の在庫数」や「出荷・返却の予測変動」を同時に把握する必要がありました。
そのため、本クエリでは、発送日～返却日をレンジとして扱う集計と、特定日の集計を分けて処理しています。

### 工夫点
- `GENERATE_DATE_ARRAY`で任意の期間の日付カレンダーを作成
- CROSS JOINで商品×日付のマトリクスを生成し、基礎データとして活用
- 発送日・返却日の範囲チェックにより、貸出レンジを可視化
- NULL時の集計漏れを防ぐため、`COALESCE(SUM(...), 0)`を活用

### 日付カレンダーの生成について

このクエリでは、日次の集計・可視化を行うために、あらかじめ対象期間（2025年4月25日～5月31日）のカレンダーテーブルを生成しています。

`GENERATE_DATE_ARRAY` を使用することで、任意の期間の日付を1日刻みで生成でき、以下のような集計で活用できます：

- 発送／返却日など、特定の動きがない日も「0件」として可視化
- データの欠損による集計漏れの防止
- 時系列グラフや日別在庫推移の正確な表示のための補完

この手法は、倉庫業務・予約管理・機器稼働分析など、**“日付の連続性が重要な業務”全般に応用可能です。**

### 想定シーン
- 倉庫業務／貸出品在庫の時系列分析
- 貸出品の稼働状況シミュレーション
- 出荷前後の在庫水準可視化（BIツールに接続しても有効）

### 応用可能なシーン

このクエリは、出荷や貸出に限らず「ある日付の範囲にまたがるイベントを、日次単位で可視化したい」ケース全般に応用可能です。

- 例：ホテルの宿泊状況（宿泊開始日〜終了日）
- 例：設備や会議室の稼働スケジュール
- 例：製造工程のマシン利用スケジュール
- 例：システム利用のユーザーセッション分析 など

処理構造は「対象 × カレンダー × 条件付き集計」の形式で組んでおり、元データを変更するだけで他業務にも展開可能です。


